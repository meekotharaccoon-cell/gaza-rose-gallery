<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pick a free flower üåπ ‚Äî Gaza Rose Gallery</title>
<style>
  :root{--rose:#ff2d6b;--gold:#ffd700;--dark:#0a0a0a;--panel:#111}
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:var(--dark);color:#eee;font-family:'Georgia',serif;min-height:100vh}

  /* HERO */
  .hero{text-align:center;padding:50px 20px 30px;background:linear-gradient(135deg,#0a0a0a,#1a0010)}
  .hero h1{font-size:clamp(1.8rem,5vw,3.2rem);color:var(--rose);margin-bottom:12px}
  .hero p{color:rgba(255,255,255,0.65);font-size:1.05rem;line-height:1.7;max-width:520px;margin:0 auto 20px}
  .hero .instruction{background:rgba(255,215,0,0.08);border:1px solid rgba(255,215,0,0.25);border-radius:12px;padding:16px 24px;max-width:480px;margin:0 auto;color:rgba(255,255,255,0.8);font-size:.95rem;line-height:1.7}
  .hero .instruction strong{color:var(--gold)}

  /* CLAIMED STATE */
  .claimed-banner{display:none;text-align:center;padding:30px 20px;background:rgba(0,255,136,0.06);border-bottom:1px solid rgba(0,255,136,0.2)}
  .claimed-banner h2{color:#00ff88;font-size:1.4rem;margin-bottom:8px}
  .claimed-banner p{color:rgba(255,255,255,0.6);font-size:.9rem;line-height:1.6}
  .claimed-banner.show{display:block}

  /* GRID */
  .search-bar{max-width:400px;margin:24px auto;padding:0 20px}
  .search-bar input{width:100%;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.15);border-radius:8px;padding:10px 16px;color:#fff;font-size:1rem;outline:none}
  .search-bar input:focus{border-color:var(--rose)}
  .loading{text-align:center;padding:60px;color:rgba(255,255,255,0.3)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;padding:0 20px 60px;max-width:1400px;margin:0 auto}

  /* CARD */
  .card{background:var(--panel);border:1px solid rgba(255,255,255,0.08);border-radius:16px;overflow:hidden;transition:all .3s;position:relative}
  .card:hover{transform:translateY(-4px);border-color:rgba(255,45,107,0.4);box-shadow:0 20px 40px rgba(255,45,107,0.15)}
  .card.claimed-card{border-color:rgba(0,255,136,0.5);box-shadow:0 0 30px rgba(0,255,136,0.2)}
  .card-img-wrap{position:relative;width:100%;aspect-ratio:1;overflow:hidden;cursor:pointer}
  .shimmer{position:absolute;inset:0;background:linear-gradient(90deg,#1a0010 25%,#2a0020 50%,#1a0010 75%);background-size:200% 100%;animation:shimmer 1.5s infinite}
  @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
  .card-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .5s}
  .card-img.loaded{opacity:1}
  .card-info{padding:14px}
  .card-name{font-size:.9rem;font-weight:bold;color:#fff;margin-bottom:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  /* FREE BUTTON */
  .btn-free{width:100%;background:linear-gradient(135deg,#ff2d6b,#ff6b35);color:#fff;border:none;border-radius:8px;padding:11px;font-size:.9rem;font-weight:bold;cursor:pointer;transition:all .2s;letter-spacing:.5px}
  .btn-free:hover{transform:scale(1.02);box-shadow:0 6px 20px rgba(255,45,107,0.4)}
  .btn-free.used{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.3);cursor:default}
  .btn-free.used:hover{transform:none;box-shadow:none}

  /* AFTER CLAIM ‚Äî buy the rest */
  .buy-section{display:none;margin-top:10px}
  .buy-section.show{display:block}
  .price-tag{color:var(--gold);font-size:.85rem;margin-bottom:8px;text-align:center}
  .paypal-wrap{min-height:44px}

  /* CHOSEN BADGE */
  .chosen-badge{display:none;position:absolute;top:10px;right:10px;background:#00ff88;color:#000;font-size:.65rem;font-weight:bold;padding:4px 10px;border-radius:20px;letter-spacing:1px;text-transform:uppercase}
  .card.claimed-card .chosen-badge{display:block}

  /* FOOTER */
  .footer{text-align:center;padding:40px 20px;border-top:1px solid rgba(255,255,255,0.06);color:rgba(255,255,255,0.3);font-size:.85rem}
  .footer a{color:var(--rose);text-decoration:none}

  @media(max-width:600px){.grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}}
</style>
</head>
<body>

<div class="hero">
  <h1>üåπ Pick one. It's yours free.</h1>
  <p>Browse the full Gaza Rose Gallery. Find the one that speaks to you. Click it ‚Äî full 300 DPI download, no strings, no email required.</p>
  <div class="instruction">
    <strong>How it works:</strong> Browse below. Click the flower you want. It downloads instantly at full resolution. The other 55 are $1 each ‚Äî and 70% of every dollar goes directly to Palestinian children's relief.
  </div>
</div>

<div class="claimed-banner" id="claimed-banner">
  <h2>‚úÖ Downloading your flower now</h2>
  <p>If you love it, the other 55 are $1 each ‚Äî every purchase sends 70% to <a href="https://www.pcrf.net" target="_blank" style="color:#00ff88">PCRF</a>.<br>
  Every artwork below now shows its price. Thank you for being here. üåπ</p>
</div>

<div class="search-bar">
  <input type="text" id="search" placeholder="Search flowers by name..." oninput="filterGallery()">
</div>

<div id="loading" class="loading">üåπ Loading gallery...</div>
<div class="grid" id="gallery"></div>

<div class="footer">
  <p>Gaza Rose Gallery ¬∑ <a href="https://www.pcrf.net" target="_blank">PCRF.net (EIN 93-1057665)</a> ¬∑ 70% of every $1 to Palestinian children's aid</p>
  <p style="margin-top:8px"><a href="index.html">‚Üê Back to full gallery</a></p>
  <p style="margin-top:8px;font-size:.75rem">Built by Meeko ¬∑ Open source ¬∑ No ads ¬∑ No middlemen</p>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=AaMNXxUU0cRwqklyGcQ4T3VP-0ymQE9aYaL_P0wwh7arTpn41GZClSDNYQI2R4dh1Nv1DhirWKfk7O31&currency=USD"></script>
<script>
const RAW    = 'https://raw.githubusercontent.com/meekotharaccoon-cell/gaza-rose-gallery/main/art/';
const COLORS = ['#3d0020','#001a20','#1a0030','#001a10','#200010','#0a2000','#1a1000','#00102a'];
let artData  = [];
let hasClaimed = false;
let paypalRendered = new Set();

function toDisplayName(f){
  return f.replace(/300\.(jpg|jpeg|png)$/i,'').replace(/_/g,' ').trim()
    .split(' ').map(w=>w.charAt(0).toUpperCase()+w.slice(1).toLowerCase()).join(' ');
}

function encUrl(f){ return f.split('').map(c=>c===' '?'%20':c).join(''); }

function buildGallery(arts){
  const grid = document.getElementById('gallery');
  grid.innerHTML = '';
  document.getElementById('loading').style.display = 'none';

  arts.forEach((art, i) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.id = 'card-' + art._idx;
    const color = COLORS[i % COLORS.length];
    const url   = RAW + encUrl(art.file);

    card.innerHTML = `
      <div class="chosen-badge">Your Pick ‚úì</div>
      <div class="card-img-wrap" style="background:linear-gradient(135deg,${color},#0a0a0a)">
        <div class="shimmer"></div>
        <img class="card-img" src="${url}" alt="${art.name}" loading="lazy"
          onload="this.classList.add('loaded');this.previousElementSibling.style.display='none'"
          onerror="this.previousElementSibling.style.display='none'">
      </div>
      <div class="card-info">
        <div class="card-name" title="${art.name}">${art.name}</div>
        <button class="btn-free" id="btn-${art._idx}" onclick="claimFree(${art._idx})">
          üåπ This one ‚Äî download free
        </button>
        <div class="buy-section" id="buy-${art._idx}">
          <div class="price-tag">$1.00 ¬∑ 70% ‚Üí PCRF</div>
          <div class="paypal-wrap" id="pp-${art._idx}"></div>
        </div>
      </div>`;
    grid.appendChild(card);
  });
}

function claimFree(idx){
  if(hasClaimed) return;
  hasClaimed = true;

  const art = artData[idx];
  const url = RAW + encUrl(art.file);

  // Download immediately
  const a = document.createElement('a');
  a.href = url; a.download = art.file; a.target = '_blank';
  document.body.appendChild(a); a.click(); document.body.removeChild(a);

  // Mark this card as chosen
  const card = document.getElementById('card-' + idx);
  card.classList.add('claimed-card');
  const btn = document.getElementById('btn-' + idx);
  btn.textContent = '‚úÖ Yours ‚Äî downloading now';
  btn.classList.add('used');

  // Show the claimed banner
  document.getElementById('claimed-banner').classList.add('show');
  window.scrollTo({top: 0, behavior: 'smooth'});

  // Disable all other free buttons, show $1 buy on everything else
  artData.forEach(a => {
    if(a._idx === idx) return;
    const b = document.getElementById('btn-' + a._idx);
    if(b){ b.textContent = '$1.00'; b.classList.add('used'); }
    showBuyButton(a._idx);
  });
}

function showBuyButton(idx){
  const art = artData[idx];
  const buyDiv = document.getElementById('buy-' + idx);
  if(!buyDiv || paypalRendered.has(idx)) return;
  buyDiv.classList.add('show');
  paypalRendered.add(idx);
  const url = RAW + encUrl(art.file);
  paypal.Buttons({
    style:{layout:'vertical',color:'gold',shape:'rect',label:'pay',height:40},
    createOrder:(_,a)=>a.order.create({purchase_units:[{
      amount:{value:'1.00'},
      description:'Gaza Rose ‚Äî ' + art.name + ' (300 DPI)'
    }]}),
    onApprove:async(_,a)=>{
      await a.order.capture();
      const l = document.createElement('a');
      l.href=url; l.download=art.file; l.target='_blank';
      document.body.appendChild(l); l.click(); document.body.removeChild(l);
      const btn = document.getElementById('btn-' + idx);
      if(btn){ btn.textContent='‚úÖ Downloaded'; }
      alert('Thank you! üåπ\nDownloading "'+art.name+'".\n70% of your $1 goes to PCRF children\'s aid.');
    },
    onError:()=>{
      window.open('mailto:mickowood86@gmail.com?subject=Purchase&body=I want: '+art.name,'_blank');
    }
  }).render('#pp-' + idx);
}

function filterGallery(){
  const q = document.getElementById('search').value.toLowerCase();
  buildGallery(artData.filter(a => a.name.toLowerCase().includes(q)));
  // If already claimed, re-show buy buttons
  if(hasClaimed){
    artData.forEach(a => {
      const b = document.getElementById('btn-' + a._idx);
      if(b && !b.classList.contains('claimed-card')){
        b.textContent='$1.00'; b.classList.add('used');
        showBuyButton(a._idx);
      }
    });
  }
}

window.onload = async function(){
  try{
    const r = await fetch('https://api.github.com/repos/meekotharaccoon-cell/gaza-rose-gallery/contents/art');
    if(!r.ok) throw new Error();
    const files = await r.json();
    artData = files.filter(f=>/\.(jpg|jpeg|png)$/i.test(f.name))
      .map((f,i)=>({name:toDisplayName(f.name),file:f.name,_idx:i}));
    // Shuffle so every visitor sees a different order
    artData.sort(()=>Math.random()-0.5);
    artData.forEach((a,i)=>a._idx=i);
    buildGallery(artData);
  }catch(e){
    document.getElementById('loading').textContent='‚ö†Ô∏è Could not load gallery ‚Äî please refresh.';
  }
};
</script>
</body>
</html>
